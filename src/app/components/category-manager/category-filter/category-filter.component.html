<div class="category-filter-container">
  <button class="filter-button" (click)="toggleDropdown()">
    <span>Filter by Category</span>
    <span class="filter-count" *ngIf="(selectedFilterIds$ | async)?.length as count">
      ({{ count }})
    </span>
    <span class="dropdown-icon">{{ isDropdownOpen ? '▲' : '▼' }}</span>
  </button>

  <div class="filter-dropdown" *ngIf="isDropdownOpen">
    <div class="dropdown-header">
      <h4>Filter by Categories</h4>
      <button
        class="clear-btn"
        (click)="onClearFilters()"
        *ngIf="(selectedFilterIds$ | async)?.length"
      >
        Clear all
      </button>
    </div>

    <div class="dropdown-content">
      <div
        *ngFor="let category of (categories$ | async)"
        class="filter-option"
        (click)="onToggleFilter(category.id)"
      >
        <input
          type="checkbox"
          [checked]="isSelected(category.id, (selectedFilterIds$ | async) || [])"
          (click)="$event.stopPropagation()"
          (change)="onToggleFilter(category.id)"
        >
        <div class="category-color-indicator" [style.background-color]="category.color"></div>
        <span class="category-name">{{ category.name }}</span>
      </div>

      <div class="empty-state" *ngIf="(categories$ | async)?.length === 0">
        No categories available
      </div>
    </div>
  </div>

  <div class="dropdown-backdrop" *ngIf="isDropdownOpen" (click)="closeDropdown()"></div>
</div>
